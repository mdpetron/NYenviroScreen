tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
bbox_new <- st_bbox(shapeny) # current bounding box
xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
bbox_new[1] <- bbox_new[1] + (0.08 * xrange) # xmin - left
bbox_new[3] <- bbox_new[3] - (0.8 * xrange) # xmax - right
bbox_new[2] <- bbox_new[2] + (0.55 * yrange) # ymin - bottom
bbox_new[4] <- bbox_new[4] - (0.32 * yrange) # ymax - top
bbox_new <- bbox_new %>%  # take the bounding box ...
st_as_sfc() # ... and make it a sf polygon
# draw a prettier chart
tm_shape(hranice, bbox = bbox_new) + tm_polygons(col = "tan") +
tm_layout(title = "A Big, Fat Title...", frame = T, title.size = 5)
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_borders() +
tm_shape(mycounty) +
tm_fill(col = "red") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
bbox_new <- st_bbox(shapeny) # current bounding box
xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
bbox_new[1] <- bbox_new[1] + (0.08 * xrange) # xmin - left
bbox_new[3] <- bbox_new[3] - (0.77 * xrange) # xmax - right
bbox_new[2] <- bbox_new[2] + (0.55 * yrange) # ymin - bottom
bbox_new[4] <- bbox_new[4] - (0.32 * yrange) # ymax - top
bbox_new <- bbox_new %>%  # take the bounding box ...
st_as_sfc() # ... and make it a sf polygon
# draw a prettier chart
tm_shape(hranice, bbox = bbox_new) + tm_polygons(col = "tan") +
tm_layout(title = "A Big, Fat Title...", frame = T, title.size = 5)
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_borders() +
tm_shape(mycounty) +
tm_fill(col = "red") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
bbox_new <- st_bbox(shapeny) # current bounding box
xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
bbox_new[1] <- bbox_new[1] + (0.08 * xrange) # xmin - left
bbox_new[3] <- bbox_new[3] - (0.75 * xrange) # xmax - right
bbox_new[2] <- bbox_new[2] + (0.55 * yrange) # ymin - bottom
bbox_new[4] <- bbox_new[4] - (0.32 * yrange) # ymax - top
bbox_new <- bbox_new %>%  # take the bounding box ...
st_as_sfc() # ... and make it a sf polygon
# draw a prettier chart
tm_shape(hranice, bbox = bbox_new) + tm_polygons(col = "tan") +
tm_layout(title = "A Big, Fat Title...", frame = T, title.size = 5)
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_borders() +
tm_shape(mycounty) +
tm_fill(col = "red") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
# draw a prettier chart
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_borders() +
tm_shape(mycounty) +
tm_fill(col = "tan") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
# draw a prettier chart
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_shape(mycounty) +
tm_fill(col = "tan") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
tmap_arrange(map2, map1)
print(inset_m, vp = grid::viewport(0.4, 0.62, width = 0.18, height = 0.18))
print(inset_m, vp = grid::viewport(0.43, 0.82, width = 0.18, height = 0.18))
print(inset_m, vp = grid::viewport(0.8, 0.6, width = 0.18, height = 0.18))
print(inset_m, vp = grid::viewport(0.9, 0.6, width = 0.18, height = 0.18))
print(inset_m, vp = grid::viewport(0.88, 0.6, width = 0.18, height = 0.18))
tmap_arrange(map2, map1)
print(inset_m, vp = grid::viewport(0.89, 0.6, width = 0.18, height = 0.18))
print(inset_m, vp = grid::viewport(0.89, 0.61, width = 0.18, height = 0.18))
print(inset_m, vp = grid::viewport(0.89, 0.605, width = 0.18, height = 0.18))
tmap_arrange(map2, map1)
print(inset_m, vp = grid::viewport(0.89, 0.605, width = 0.18, height = 0.18))
#or using ggplot
p = ggplot(highScore, aes(x=Indicator, y=`NYS Percentile`, fill=`NYS Percentile`)) +
geom_bar(binwidth=1, stat=’identity’) +theme_light() +
scale_fill_gradient(low=’red’, high=’white’, limits=c(5,40)) +
theme(axis.title.y=element_text(angle=0))
p + theme(axis.text.x = element_text(angle=45, vjust = 1, hjust=1))
#or using ggplot
p = ggplot(highScore, aes(x=Indicator, y=`NYS Percentile`, fill=`NYS Percentile`)) +
geom_bar(binwidth=1, stat=’identity’) +theme_light() +
scale_fill_gradient(low=’red’, high=’white’, limits=c(5,40)) +
theme(axis.title.y=element_text(angle=0))
#or using ggplot
p = ggplot(highScore, aes(x=Indicator, y=`NYS Percentile`, fill=`NYS Percentile`)) +
geom_bar(binwidth=1, stat='identity') +theme_light() +
scale_fill_gradient(low="red", high="white", limits=c(5,40)) +
theme(axis.title.y=element_text(angle=0))
p + theme(axis.text.x = element_text(angle=45, vjust = 1, hjust=1))
#or using ggplot
p = ggplot(highScore, aes(x=Indicator, y=`NYS Percentile`, fill=`NYS Percentile`)) +
geom_bar(binwidth=1, stat='identity') + theme_light() +
scale_fill_gradient(low="red", high="white", limits=c(5,40)) +
theme(axis.title.y=element_text(angle=0))
#or using ggplot
p = ggplot(highScore, aes(x=Indicator, y=`NYS Percentile`, fill=`NYS Percentile`)) +
geom_histogram(binwidth=1, stat='identity') + theme_light() +
scale_fill_gradient(low="red", high="white", limits=c(5,40)) +
theme(axis.title.y=element_text(angle=0))
p + theme(axis.text.x = element_text(angle=45, vjust = 1, hjust=1))
p + coord_polar()
#or using ggplot
p = ggplot(highScore, aes(x=Indicator, y=`NYS Percentile`, fill=`NYS Percentile`)) +
geom_histogram(binwidth=1, stat='identity') + theme_light() +
scale_fill_gradient(low="red", high="white", limits=c(0,100)) +
theme(axis.title.y=element_text(angle=0))
p + theme(axis.text.x = element_text(angle=45, vjust = 1, hjust=1))
p + coord_polar()
ejshp$`County Name`
#Cattaraugus
Rich <- subset(ejshp, ejshp$`County Name` %in% c("Ulster", "Sullivan",
"Dutchess", "Orange",
"Putnam", "West-chester",
"Nassau", "Queens",
"Kings", "Suffolk",
"Richmond", "New York",
"Bronx", "Rockland") & ejshp$ALAND > 0)
unique(Rich$`County Name`)
#Cattaraugus
Rich <- subset(ejshp, ejshp$`County Name` %in% c("Ulster", "Sullivan",
"Dutchess", "Orange",
"Putnam", "Westchester",
"Nassau", "Queens",
"Kings", "Suffolk",
"Richmond", "New York",
"Bronx", "Rockland") & ejshp$ALAND > 0)
unique(Rich$`County Name`)
unique(strsplit(Rich$GEOID, 1, 5))
unique(strspt(Rich$GEOID, 1, 5))
unique(substr(Rich$GEOID, 1, 5))
unique(substr(Rich$GEOID, 3, 5))
Rich00 <- subset(ej2k, ej2k$COUNTY %in% unique(substr(Rich$GEOID, 3, 5)))
Rich$peja_18_hybrid_cat <- ifelse(Rich$peja_18_hybrid == 1 & Rich$peja_18_breaks == 1 &
Rich$peja_18_cal == 1, "Both",
ifelse(Rich$peja_18_breaks == 1 & Rich$peja_18_cal == 0, "Breaks",
ifelse(Rich$peja_18_cal == 1 & Rich$peja_18_breaks == 0, "CalEPA", "No")))
map1 <- tm_shape(Rich) +
tm_fill(col = "peja_18_hybrid_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("blue", "green", "yellow", "tan", "grey")) +
tm_borders() +
# tm_compass(type = "8star", position = c("left", "middle")) +
tm_layout("2020 - Hybrid - Niagara & Orleans Counties, NY",
legend.position = c("left","top"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
map1
map1 <- tm_shape(Rich) +
tm_fill(col = "peja_18_hybrid_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("blue", "green", "yellow", "tan", "grey")) +
# tm_compass(type = "8star", position = c("left", "middle")) +
tm_layout("2020 - Hybrid - Niagara & Orleans Counties, NY",
legend.position = c("left","top"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
map1
map1 <- tm_shape(Rich) +
tm_fill(col = "peja_18_hybrid_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("blue", "green", "yellow", "tan", "grey")) +
# tm_compass(type = "8star", position = c("left", "middle")) +
tm_layout("2020 - Hybrid - Niagara & Orleans Counties, NY",
legend.position = c("left","top"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
map1
Rich00$peja_00_cat <- ifelse(Rich00$peja2k.1 == 1, "Yes", "No")
map2 <- tm_shape(Rich00) +
tm_fill(col = "peja_00_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("tan", "purple", "grey")) +
# tm_borders() +
tm_layout("2000 - Niagara & Orleans, NY",
legend.position = c("left","top"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
map2
#now for the inset map
mycounty <- subset(nycounties, nycounties$NAME %in% c("Ulster", "Sullivan",
"Dutchess", "Orange",
"Putnam", "Westchester",
"Nassau", "Queens",
"Kings", "Suffolk",
"Richmond", "New York",
"Bronx", "Rockland"))
map2 <- tm_shape(Rich00) +
tm_fill(col = "peja_00_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("tan", "purple", "grey")) +
tm_shape(mycounty) +
tm_borders() +
tm_layout("2000 - Niagara & Orleans, NY",
legend.position = c("left","top"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
map2
bbox_new <- st_bbox(shapeny) # current bounding box
xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
bbox_new[1] <- bbox_new[1] + (0.08 * xrange) # xmin - left
bbox_new[3] <- bbox_new[3] - (0.75 * xrange) # xmax - right
bbox_new[2] <- bbox_new[2] + (0.55 * yrange) # ymin - bottom
bbox_new[4] <- bbox_new[4] - (0.32 * yrange) # ymax - top
bbox_new <- bbox_new %>%  # take the bounding box ...
st_as_sfc() # ... and make it a sf polygon
# draw a prettier chart
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_shape(mycounty) +
tm_fill(col = "tan") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
bbox_new <- st_bbox(shapeny) # current bounding box
xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
bbox_new[1] <- bbox_new[1] + (0.7 * xrange) # xmin - left
bbox_new[3] <- bbox_new[3] - (0.01 * xrange) # xmax - right
bbox_new[2] <- bbox_new[2] + (0.01 * yrange) # ymin - bottom
bbox_new[4] <- bbox_new[4] - (0.72 * yrange) # ymax - top
bbox_new <- bbox_new %>%  # take the bounding box ...
st_as_sfc() # ... and make it a sf polygon
# draw a prettier chart
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_shape(mycounty) +
tm_fill(col = "tan") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
bbox_new <- st_bbox(shapeny) # current bounding box
xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
bbox_new[1] <- bbox_new[1] + (0.6 * xrange) # xmin - left
bbox_new[3] <- bbox_new[3] - (0.000000000000001 * xrange) # xmax - right
bbox_new[2] <- bbox_new[2] + (0.000000000000001 * yrange) # ymin - bottom
bbox_new[4] <- bbox_new[4] - (0.6 * yrange) # ymax - top
bbox_new <- bbox_new %>%  # take the bounding box ...
st_as_sfc() # ... and make it a sf polygon
# draw a prettier chart
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_shape(mycounty) +
tm_fill(col = "tan") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
bbox_new <- st_bbox(shapeny) # current bounding box
xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
bbox_new[1] <- bbox_new[1] + (0.58 * xrange) # xmin - left
bbox_new[3] <- bbox_new[3] - (0.000000000000001 * xrange) # xmax - right
bbox_new[2] <- bbox_new[2] + (0.000000000000001 * yrange) # ymin - bottom
bbox_new[4] <- bbox_new[4] - (0.58 * yrange) # ymax - top
bbox_new <- bbox_new %>%  # take the bounding box ...
st_as_sfc() # ... and make it a sf polygon
# draw a prettier chart
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_shape(mycounty) +
tm_fill(col = "tan") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
bbox_new <- st_bbox(shapeny) # current bounding box
xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
bbox_new[1] <- bbox_new[1] + (0.57 * xrange) # xmin - left
bbox_new[3] <- bbox_new[3] - (0.000000000000001 * xrange) # xmax - right
bbox_new[2] <- bbox_new[2] + (0.000000000000001 * yrange) # ymin - bottom
bbox_new[4] <- bbox_new[4] - (0.57 * yrange) # ymax - top
bbox_new <- bbox_new %>%  # take the bounding box ...
st_as_sfc() # ... and make it a sf polygon
# draw a prettier chart
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_shape(mycounty) +
tm_fill(col = "tan") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
tmap_arrange(map2, map1)
print(inset_m, vp = grid::viewport(0.89, 0.605, width = 0.18, height = 0.18))
print(inset_m, vp = grid::viewport(0.89, 0.605, width = 0.18, height = 0.18))
tmap_arrange(map2, map1)
map1 <- tm_shape(Rich) +
tm_fill(col = "peja_18_hybrid_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("blue", "green", "yellow", "tan", "grey")) +
tm_shape(mycounty) +
tm_borders() +
# tm_compass(type = "8star", position = c("left", "middle")) +
tm_layout("2020 - Hybrid - Niagara & Orleans Counties, NY",
legend.position = c("left","bottom"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
map1 <- tm_shape(Rich) +
tm_fill(col = "peja_18_hybrid_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("blue", "green", "yellow", "tan", "grey")) +
tm_shape(mycounty) +
tm_borders() +
# tm_compass(type = "8star", position = c("left", "middle")) +
tm_layout("Downstate, NY - 2020 Hybid Model PEJAs",
legend.position = c("left","bottom"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
map1
Rich00$peja_00_cat <- ifelse(Rich00$peja2k.1 == 1, "Yes", "No")
map2 <- tm_shape(Rich00) +
tm_fill(col = "peja_00_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("tan", "purple", "grey")) +
tm_shape(mycounty) +
tm_borders() +
tm_layout("Downstate, NY - 2003 Potential Environmental Justice Areas (PEJA)",
legend.position = c("left","top"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
map2
#for the box
bbox_new <- st_bbox(shapeny) # current bounding box
xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
bbox_new[1] <- bbox_new[1] + (0.57 * xrange) # xmin - left
bbox_new[3] <- bbox_new[3] - (0.000000000000001 * xrange) # xmax - right
bbox_new[2] <- bbox_new[2] + (0.000000000000001 * yrange) # ymin - bottom
bbox_new[4] <- bbox_new[4] - (0.57 * yrange) # ymax - top
bbox_new <- bbox_new %>%  # take the bounding box ...
st_as_sfc() # ... and make it a sf polygon
# draw a prettier chart
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_shape(mycounty) +
tm_fill(col = "tan") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
library(grid)
tmap_arrange(map2, map1)
tmap_arrange(map2, map1)
map1a <- tm_shape(Rich) +
tm_fill(col = "peja_18_hybrid_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("blue", "green", "yellow", "tan", "grey")) +
tm_shape(mycounty) +
tm_borders() +
# tm_compass(type = "8star", position = c("left", "middle")) +
tm_layout("Downstate, NY - 2020 Hybrid Model PEJAs",
legend.position = c("left","bottom"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
tmap_arrange(map2, map1a)
print(inset_m, vp = grid::viewport(0.89, 0.605, width = 0.3, height = 0.3))
print(inset_m, vp = grid::viewport(0.89, 0.605, width = 0.3, height = 0.3))
print(inset_m, vp = grid::viewport(0.89, 0.605, width = 0.3, height = 0.3))
map1a <- tm_shape(Rich) +
tm_fill(col = "peja_18_hybrid_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("blue", "green", "yellow", "tan", "grey")) +
tm_shape(mycounty) +
tm_borders() +
# tm_compass(type = "8star", position = c("left", "middle")) +
tm_layout("Downstate, NY - 2020 Hybrid Model PEJAs",
legend.position = c("left","bottom"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
Rich00$peja_00_cat <- ifelse(Rich00$peja2k.1 == 1, "Yes", "No")
map2 <- tm_shape(Rich00) +
tm_fill(col = "peja_00_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("tan", "purple", "grey")) +
tm_shape(mycounty) +
tm_borders() +
tm_layout("Downstate, NY - 2003 Potential Environmental Justice Areas (PEJA)",
legend.position = c("left","bottom"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
bbox_new <- st_bbox(shapeny) # current bounding box
xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
bbox_new[1] <- bbox_new[1] + (0.57 * xrange) # xmin - left
bbox_new[3] <- bbox_new[3] - (0.000000000000001 * xrange) # xmax - right
bbox_new[2] <- bbox_new[2] + (0.000000000000001 * yrange) # ymin - bottom
bbox_new[4] <- bbox_new[4] - (0.57 * yrange) # ymax - top
bbox_new <- bbox_new %>%  # take the bounding box ...
st_as_sfc() # ... and make it a sf polygon
# draw a prettier chart
inset_m <- tm_shape(shapeny) +
tm_fill(col = "grey") +
tm_shape(mycounty) +
tm_fill(col = "tan") +
tm_borders() +
tm_shape(bbox_new) +
tm_borders(col = "red", lwd = 3)
inset_m
tmap_arrange(map2, map1a)
print(inset_m, vp = grid::viewport(0.89, 0.605, width = 0.3, height = 0.3))
map2 <- tm_shape(Rich00) +
tm_fill(col = "peja_00_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("tan", "purple", "grey")) +
tm_shape(mycounty) +
tm_borders() +
tm_layout("Downstate, NY - 2003 Potential Environmental Justice Areas (PEJA)",
legend.position = c("left","bottom"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
tmap_arrange(map2, map1a)
map1a
gc()
map2
map2 <- tm_shape(Rich00) +
tm_fill(col = "peja_00_cat",
style = "cat",
title = "PEJA",
alpha = 1,
palette = c("tan", "purple", "grey")) +
tm_shape(mycounty) +
tm_borders() +
tm_layout("Downstate, NY - 2003 Potential Environmental Justice Areas (PEJA)",
legend.position = c("left","bottom"),
bg.color = "white",
title.size = 1,
inner.margin = .08,
legend.title.size = 1)
map2
map2
write_rds(ny_enviro_screen_data, "data/ny_enviro_screen_data.rds")
write_rds(ejshp, "C:/Users/Mike Petroni/Documents/GitHub/NYenviroScreen/NYenviroScreen-app/www/ejshp_061520.rds")
write_rds(ej2k, "C:/Users/Mike Petroni/Documents/GitHub/NYenviroScreen/NYenviroScreen-app/www/peja2k_061520.rds")
